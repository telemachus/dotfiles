#!/usr/bin/env bash

set -euo pipefail

VIM_HOME="$HOME/local/vim"
BUILD_ROOT="$HOME/Downloads/src"
BUILD_FULL="$HOME/Downloads/src/vim"
BUILD_SOURCE="${BUILD_FULL}/src"

if [ ! -d "$BUILD_ROOT" ]; then
	mkdir -p "$BUILD_ROOT"
fi

cd "$BUILD_ROOT" || exit 1
if [ ! -d "$BUILD_FULL" ]; then
	git clone https://github.com/vim/vim.git
fi

cd "$BUILD_FULL" || exit 1
git pull

cd "$BUILD_SOURCE" || exit 1
make clean distclean
./configure --prefix="$VIM_HOME" \
	--enable-fail-if-missing \
	--enable-multibyte \
	--with-compiledby="Peter Aronoff <peteraronoff@fastmail.com>" \
	--enable-cscope \
	--enable-terminal \
	--enable-gui=no \
	--without-x \
	--enable-fontset \
	--enable-largefile \
	--disable-smack \
	--disable-selinux \
	--disable-xattr \
	--disable-xsmp \
	--disable-xsmp-interact \
	--disable-nls \
	--disable-canberra \

make || exit 1
rm -rf "$VIM_HOME"
make install

vbundleup

# vim: set ts=8 sw=8 tw=0 noet ft=sh :
